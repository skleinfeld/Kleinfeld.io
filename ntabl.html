---
layout: default
title: NTABL
permalink: /ntabl/
---

<section class="relative overflow-hidden">
  <div class="pointer-events-none absolute inset-0 -z-10">
    <div class="absolute -top-40 left-1/2 -translate-x-1/2 h-[520px] w-[1200px] rounded-full blur-3xl"
         style="background:radial-gradient(ellipse at center, rgba(10,132,255,.18), rgba(191,90,242,.12) 45%, transparent 65%)"></div>
  </div>

  <div class="wrap mx-auto px-4 sm:px-6 py-12">
    <div class="mb-8">
      <h1 class="text-3xl font-semibold">NTABL</h1>
      <p class="text-d-sub mt-1 text-[15px]">Personal and Team statistics, updated from CSV files in this repository.</p>
    </div>

    <!-- Switcher -->
    <div class="rounded-2xl border border-d-line bg-d-card p-3 flex flex-wrap items-center gap-2">
      <button id="btn-personal" class="px-4 py-2 text-sm rounded-full bg-white text-black">Personal Stats</button>
      <button id="btn-team" class="px-4 py-2 text-sm rounded-full border border-d-line hover:bg-white/5">Team Stats</button>

      <div class="ml-auto flex items-center gap-2">
        <label for="season" class="text-[13px] text-d-sub">Season</label>
        <select id="season" class="bg-transparent border border-d-line rounded-full px-3 py-1.5 text-sm">
          <option value="summer2024">Summer 2024</option>
          <option value="summer2025">Summer 2025</option>
          <option value="fall2025">Fall 2025</option>
          <option value="career">Career</option>
        </select>
      </div>
    </div>

    <!-- Header cards -->
    <div class="grid sm:grid-cols-2 gap-6 mt-6">
      <!-- Personal -->
      <div class="rounded-2xl border border-d-line bg-d-card p-5 flex items-center gap-4">
        <div class="relative h-14 w-14 rounded-full p-[2px]" style="background:conic-gradient(from 180deg,#0A84FF,#BF5AF2,#0A84FF)">
          <img src="{{ '/SBK-Headshot.jpeg' | relative_url }}" alt="Saul B. Kleinfeld"
               class="h-full w-full rounded-full object-cover ring-1 ring-d-line bg-d-card">
        </div>
        <div>
          <div class="text-sm text-d-sub">Personal</div>
          <div class="font-medium">Saul B. Kleinfeld</div>
        </div>
      </div>

      <!-- Team -->
      <div class="rounded-2xl border border-d-line bg-d-card p-5 flex items-center gap-4">
        <img src="{{ "NTABL - Gann's Bulls Logo.png" | relative_url | uri_escape }}"
             alt="Gann’s Bulls" class="h-14 w-14 rounded-md bg-white object-contain p-1.5">
        <div>
          <div class="text-sm text-d-sub">Team</div>
          <div class="font-medium">Gann’s Bulls</div>
        </div>
      </div>
    </div>

    <!-- Table -->
    <div class="rounded-2xl border border-d-line bg-d-card shadow-card overflow-hidden mt-6">
      <div class="overflow-x-auto">
        <table class="min-w-[1000px] w-full text-sm">
          <thead class="bg-white/5 sticky top-0 z-10" id="tbl-head"></thead>
          <tbody id="tbl-body"></tbody>
          <tfoot id="tbl-foot"></tfoot>
        </table>
      </div>
    </div>

    <p class="mt-3 text-d-sub text-[12px]">
      If columns exist, derived metrics are computed as: AVG = H/AB • OBP = (H+BB+HBP)/(AB+BB+HBP+SF) • SLG = TB/AB • OPS = OBP+SLG.
    </p>
  </div>
</section>

<!-- Papa Parse for robust CSV parsing -->
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<script>
/* ---------- File map (relative to repo root) ---------- */
const files = {
  personal: {
    summer2024: "{{ 'Saul Kleinfed\\'s Career Stats.csv' | relative_url | uri_escape }}", // if you have per-season personal CSVs, point here
    summer2025: "{{ 'Saul Kleinfed\\'s Career Stats.csv' | relative_url | uri_escape }}",
    fall2025:   "{{ 'Saul Kleinfed\\'s Career Stats.csv' | relative_url | uri_escape }}",
    career:     "{{ 'Saul Kleinfed\\'s Career Stats.csv' | relative_url | uri_escape }}"
  },
  team: {
    summer2024: "{{ 'Gann\\'s Bulls Summer 2024 Stats.csv' | relative_url | uri_escape }}",
    summer2025: "{{ 'Gann\\'s Bulls Summer 2025 Stats.csv' | relative_url | uri_escape }}",
    fall2025:   "{{ 'Gann\\'s Bulls Fall 2025 Stats.csv'   | relative_url | uri_escape }}",
    career:     "{{ 'Gann\\'s Bulls Summer 2024 Stats.csv' | relative_url | uri_escape }}"
  }
};

// default state
let currentSection = 'personal';
let currentSeason  = 'summer2024';

const btnPersonal = document.getElementById('btn-personal');
const btnTeam     = document.getElementById('btn-team');
const seasonSel   = document.getElementById('season');
const thead       = document.getElementById('tbl-head');
const tbody       = document.getElementById('tbl-body');
const tfoot       = document.getElementById('tbl-foot');

btnPersonal.addEventListener('click', () => {
  currentSection = 'personal';
  styleButtons();
  loadTable();
});
btnTeam.addEventListener('click', () => {
  currentSection = 'team';
  styleButtons();
  loadTable();
});
seasonSel.addEventListener('change', () => {
  currentSeason = seasonSel.value;
  loadTable();
});

function styleButtons(){
  btnPersonal.className = currentSection==='personal'
    ? 'px-4 py-2 text-sm rounded-full bg-white text-black'
    : 'px-4 py-2 text-sm rounded-full border border-d-line hover:bg-white/5';
  btnTeam.className = currentSection==='team'
    ? 'px-4 py-2 text-sm rounded-full bg-white text-black'
    : 'px-4 py-2 text-sm rounded-full border border-d-line hover:bg-white/5';
}

function fetchCSV(url){
  return new Promise((resolve, reject) => {
    Papa.parse(url, {
      download: true,
      header: true,
      dynamicTyping: true,
      skipEmptyLines: 'greedy',
      complete: results => resolve(results.data),
      error: reject
    });
  });
}

// helpers for derived stats (only if columns exist)
const fmt3 = n => (isNaN(n) ? '—' : Number(n).toFixed(3).replace(/^0/, ''));
const divz = (n, d) => d > 0 ? n/d : 0;

function computeDerived(rows){
  const keys = Object.keys(rows[0] || {});
  const have = name => keys.includes(name);

  const computed = rows.map(r => {
    const H   = have('H')   ? Number(r['H'])   || 0 : 0;
    const AB  = have('AB')  ? Number(r['AB'])  || 0 : 0;
    const BB  = have('BB')  ? Number(r['BB'])  || 0 : 0;
    const HBP = have('HBP') ? Number(r['HBP']) || 0 : 0;
    const _1B = have('1B')  ? Number(r['1B'])  || 0 : 0;
    const _2B = have('2B')  ? Number(r['2B'])  || 0 : 0;
    const _3B = have('3B')  ? Number(r['3B'])  || 0 : 0;
    const HR  = have('HR')  ? Number(r['HR'])  || 0 : 0;
    const SF  = have('SF')  ? Number(r['SF'])  || 0 : 0;

    const TB  = _1B + 2*_2B + 3*_3B + 4*HR;
    const AVG = divz(H, AB);
    const OBP = divz((H + BB + HBP), (AB + BB + HBP + SF));
    const SLG = divz(TB, AB);
    const OPS = OBP + SLG;

    return { ...r, AVG: have('AB') && have('H') ? fmt3(AVG) : r.AVG ?? '—',
                 OBP: (have('AB') && (have('BB')||have('HBP'))) ? fmt3(OBP) : r.OBP ?? '—',
                 SLG: (have('AB') && (have('1B')||have('2B')||have('3B')||have('HR'))) ? fmt3(SLG) : r.SLG ?? '—',
                 OPS: (have('AB') && (have('BB')||have('HBP')||have('1B')||have('2B')||have('3B')||have('HR'))) ? fmt3(OPS) : r.OPS ?? '—' };
  });

  return computed;
}

function buildTable(rows){
  if(!rows || rows.length === 0){
    thead.innerHTML = tbody.innerHTML = tfoot.innerHTML =
      '<tr><td class="px-4 py-3">No data found.</td></tr>';
    return;
  }

  const cols = Object.keys(rows[0]);

  // Head
  thead.innerHTML = '<tr class="text-left">' + cols.map(c =>
    `<th class="px-4 py-3 border-b border-d-line">${c}</th>`).join('') + '</tr>';

  // Body
  tbody.innerHTML = rows.map((r, i) => {
    const row = cols.map(c => `<td class="px-4 py-2.5 border-t border-d-line">${r[c] ?? ''}</td>`).join('');
    const stripe = i % 2 ? 'bg-white/[.03] hover:bg-white/[.06]' : 'hover:bg-white/[.06]';
    return `<tr class="${stripe}">${row}</tr>`;
  }).join('');

  // Totals (if numeric columns)
  const numeric = new Set();
  rows.forEach(r => Object.entries(r).forEach(([k,v]) => { if(!isNaN(v) && v!=='' && v!==null) numeric.add(k); }));
  const totals = {};
  numeric.forEach(k => totals[k] = rows.reduce((a, r) => a + (Number(r[k])||0), 0));

  if(numeric.size){
    tfoot.innerHTML = '<tr class="bg-white/5">' +
      cols.map((c, idx) => {
        if(idx===0) return `<th class="px-4 py-3 border-t border-d-line text-left" colspan="1">Totals</th>`;
        const val = totals[c] ?? '';
        return `<th class="px-4 py-3 border-t border-d-line text-left">${val!=='' ? val : ''}</th>`;
      }).join('') +
    '</tr>';
  } else {
    tfoot.innerHTML = '';
  }
}

async function loadTable(){
  const url = files[currentSection][currentSeason];
  try{
    const data = await fetchCSV(url);
    const rows = computeDerived(data);
    buildTable(rows);
  } catch(e){
    console.error(e);
    thead.innerHTML = tbody.innerHTML = tfoot.innerHTML =
      '<tr><td class="px-4 py-3">Unable to load CSV.</td></tr>';
  }
}

// initial render
styleButtons();
loadTable();
</script>