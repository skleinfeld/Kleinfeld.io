---
layout: default
title: NTABL â€” Career Batting
permalink: /ntabl/
---

<section class="wrap-wide" style="padding:40px 0;">
  <h1 style="font-size:22px;font-weight:700;margin:0 0 16px">NTABL</h1>

  <div class="surface" style="margin:0 auto;">
    <div class="ntabl-wrap">
      <table id="ntabl-table" class="ntabl-table" aria-describedby="ntabl-note">
        <thead></thead>
        <tbody></tbody>
        <tfoot></tfoot>
      </table>
    </div>
    <div id="ntabl-note" style="font-size:12px;color:#667085;padding:10px 12px 14px">
      Derived metrics shown if provided by the CSV (AVG, OBP, SLG, OPS).
    </div>
  </div>
</section>

<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<script>
(function(){
  const CSV_PATH = "/personal-batting-career.csv";
  const table   = document.getElementById('ntabl-table');
  const theadEl = table.querySelector('thead');
  const tbodyEl = table.querySelector('tbody');
  const tfootEl = table.querySelector('tfoot');

  const COLUMNS = [
    'Season','Division','Team','Last','First',
    'GP','PA','AB','R','H','1B','2B','3B','HR','RBI',
    'BB','HBP','SO','K-L','SB','TB','AVG','OBP','SLG','OPS','SF','SAC'
  ];
  const TEXT_COLS = new Set(['Season','Division','Team','Last','First']);

  const normalizeKey = k => String(k).trim().replace(/\u2013|\u2014/g,'-').replace(/\s+/g,' ').toLowerCase();
  const aliases = {
    'season':'Season','division':'Division','team':'Team','last':'Last','first':'First',
    'gp':'GP','g':'GP','pa':'PA','ab':'AB','r':'R','h':'H','1b':'1B','2b':'2B','3b':'3B','hr':'HR','rbi':'RBI',
    'bb':'BB','so':'SO','k-l':'K-L','k l':'K-L','hbp':'HBP','sb':'SB','tb':'TB',
    'avg':'AVG','obp':'OBP','slg':'SLG','ops':'OPS','sf':'SF','sac':'SAC'
  };

  function normalizeRows(rows){
    return rows.map(row=>{
      const out = {};
      Object.entries(row).forEach(([k,v])=>{
        const key = aliases[normalizeKey(k)] || k;
        out[key] = v;
      });
      return out;
    });
  }

  function selectAndOrder(rows){
    if(!rows || !rows.length) return { cols:[], rows:[] };
    const present = new Set(Object.keys(rows[0]));
    const cols = COLUMNS.filter(c => present.has(c));
    const filtered = rows.map(r=>{
      const o = {}; cols.forEach(c => o[c] = r[c] ?? ''); return o;
    });
    return { cols, rows: filtered };
  }

  const numLike = v => (v!=='' && v!==null && !isNaN(v));
  const isMetric = c => ['AVG','OBP','SLG','OPS'].includes(c);

  function buildHead(cols){
    theadEl.innerHTML = '<tr>'+cols.map(c=>{
      const cls = TEXT_COLS.has(c) ? 't-text' : 't-num';
      return `<th scope="col" class="${cls}" title="${c}">${c}</th>`;
    }).join('')+'</tr>';
  }

  function buildBody(cols, rows){
    tbodyEl.innerHTML = rows.map(r=>{
      return '<tr>'+cols.map(c=>{
        let val = r[c] ?? '';
        if(isMetric(c) && numLike(val)){ val = Number(val).toFixed(3).replace(/^0/,''); }
        const cls = TEXT_COLS.has(c) ? 't-text' : 't-num';
        return `<td class="${cls}">${val}</td>`;
      }).join('')+'</tr>';
    }).join('');
  }

  function buildTotals(cols, rows){
    const totals = {}; cols.forEach(c => totals[c] = TEXT_COLS.has(c) ? '' : 0);
    cols.forEach(c=>{
      if(TEXT_COLS.has(c) || isMetric(c)) return;
      let sum = 0, any = false;
      rows.forEach(r=>{
        const v = r[c]; if(numLike(v)){ sum += (+v||0); any = true; }
      });
      totals[c] = any ? sum : '';
    });
    tfootEl.innerHTML = '<tr>'+
      cols.map((c,i)=>{
        if(i===0) return '<th scope="row" class="t-text">Totals</th>';
        const cls = TEXT_COLS.has(c) ? 't-text' : 't-num';
        return `<td class="${cls}">${totals[c] ?? ''}</td>`;
      }).join('') +
    '</tr>';
  }

  function render(raw){
    const norm = normalizeRows(raw);
    const { cols, rows } = selectAndOrder(norm);
    if(!cols.length || !rows.length){
      theadEl.innerHTML = '<tr><th>Error</th></tr>';
      tbodyEl.innerHTML = '<tr><td style="padding:12px 14px;color:#c00">No rows/columns found in CSV.</td></tr>';
      tfootEl.innerHTML = '';
      return;
    }
    buildHead(cols); buildBody(cols, rows); buildTotals(cols, rows);
  }

  Papa.parse(CSV_PATH, {
    download:true, header:true, dynamicTyping:true, skipEmptyLines:'greedy',
    complete: res => render(res.data),
    error: err => {
      console.error('CSV load error:', err);
      theadEl.innerHTML = '<tr><th>Error</th></tr>';
      tbodyEl.innerHTML = `<tr><td style="padding:12px 14px;color:#c00">Unable to load CSV (${err?.message||'unknown error'}). Check <code>${CSV_PATH}</code>.</td></tr>`;
      tfootEl.innerHTML = '';
    }
  });
})();
</script>