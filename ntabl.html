---
layout: default
title: NTABL
permalink: /ntabl/
---

<!-- North Texas Amateur Baseball League | Interactive Hitting Stats -->
<link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<style>
  /* Page frame */
  .ntabl-wrap {
    max-width: 1600px;   /* wider so we can show every stat without scrolling */
    margin: 24px auto 80px;
    padding: 0 12px;
  }
  .ntabl-title {
    font-weight: 600;
    font-size: 18px;
    letter-spacing: .2px;
    text-align: center;
    margin: 6px 0 14px;
  }

  /* Filters: 5 selects + Clear + Reset (all same width) */
  .ntabl-filters {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 10px;
    background: rgba(255,255,255,.04);
    border: 1px solid rgba(255,255,255,.08);
    padding: 12px;
    border-radius: 10px;
    backdrop-filter: blur(4px);
  }
  .ntabl-select, .ntabl-btn {
    appearance: none;
    width: 100%;
    padding: 10px 12px;
    border-radius: 10px;
    border: 1px solid rgba(255,255,255,.10);
    background: rgba(18,18,18,.6);
    color: #eaeaea;
    font-size: 13px;
    outline: none;
  }
  .ntabl-select:focus, .ntabl-btn:focus {
    border-color: rgba(130, 87, 229, .6);
    box-shadow: 0 0 0 3px rgba(130,87,229,.25);
  }
  .ntabl-btn {
    text-align: center;
    cursor: pointer;
    background: linear-gradient(180deg, rgba(130,87,229,.22), rgba(130,87,229,.12));
  }
  .ntabl-btn:disabled {
    opacity: .45;
    cursor: not-allowed;
  }

  /* Table shell */
  .table-card {
    margin-top: 14px;
    border-radius: 12px;
    border: 1px solid rgba(255,255,255,.08);
    background: rgba(255,255,255,.03);
    overflow: hidden;
  }
  table.stats {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0;
    table-layout: fixed;        /* fixed layout so all columns stay visible */
    font-size: 11.5px;          /* slightly tighter font to fit all columns */
  }
  thead th {
    position: sticky;
    top: 0;
    z-index: 3;
    background: rgba(24,24,28,.95);
    color: #e8e8e8;
    font-weight: 600;
    text-align: center;
    padding: 8px 6px;           /* tighter */
    border-bottom: 1px solid rgba(255,255,255,.08);
    user-select: none;
  }
  tbody td {
    padding: 7px 6px;
    color: #e0e0e0;
    text-align: center;
    border-bottom: 1px solid rgba(255,255,255,.06);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  tbody td.left, thead th.left { text-align: left; }

  /* Column widths tuned to avoid horizontal scroll */
  .col-player  { width: 170px; }
  .col-year    { width: 52px; }
  .col-season  { width: 74px; }
  .col-program { width: 88px; }
  .col-team    { width: 118px; }

  .col-gp, .col-pa, .col-ab, .col-r, .col-h,
  .col-1b, .col-2b, .col-3b, .col-hr, .col-rbi,
  .col-bb, .col-hbp, .col-so, .col-sb, .col-kl, .col-sf,
  .col-avg, .col-obp, .col-slg, .col-ops { width: 42px; } /* compact numeric */

  /* Hover highlight (row+column) */
  tbody tr:hover td { background: rgba(128,128,160,.10); }
  tbody td.hover-col { background: rgba(128,128,160,.14) !important; }
  thead th.hover-head { background: rgba(24,24,28,1); color: #fff; }

  /* Sortable headers */
  thead th.sortable { cursor: pointer; }
  thead th.sortable:hover { color: #a98bff; }

  /* Player link styling */
  a.player-link {
    color: #cbd5ff;
    text-decoration: none;
    border-bottom: 1px dotted transparent;
  }
  a.player-link:hover {
    border-bottom-color: #cbd5ff;
    color: #e4e8ff;
  }

  /* Totals row */
  tfoot td {
    font-weight: 600;
    background: rgba(255,255,255,.05);
    border-top: 1px solid rgba(255,255,255,.10);
    padding: 8px 6px;
  }

  .helper {
    font-size: 12px;
    color: #b7b7b7;
    margin-top: 8px;
    text-align: left;
  }
</style>

<div class="ntabl-wrap">
  <h1 class="ntabl-title">North Texas Amateur Baseball League | Interactive Hitting Stats</h1>

  <!-- Filters: Year, Season, Program, Team, Player, Clear Player, Reset -->
  <div class="ntabl-filters" id="filters">
    <select id="filter-year" class="ntabl-select"></select>
    <select id="filter-season" class="ntabl-select"></select>
    <select id="filter-program" class="ntabl-select"></select>
    <select id="filter-team" class="ntabl-select"></select>
    <select id="filter-player" class="ntabl-select"></select>
    <button id="btn-clear-player" class="ntabl-btn" type="button" disabled>Clear Player</button>
    <button id="btn-reset" class="ntabl-btn" type="button">Reset Filters</button>
  </div>

  <div class="table-card">
    <table class="stats" id="stats">
      <thead id="thead"></thead>
      <tbody id="tbody"></tbody>
      <tfoot id="tfoot"></tfoot>
    </table>
  </div>

  <div class="helper">Hover to highlight row &amp; column. Click a player name to filter by that player. Click headers to sort.</div>
</div>

<script>
  // CSV path (baseurl-safe)
  const CSV_URL = "{{ '/ntabl-hitting-stats.csv' | relative_url }}";

  // Column definitions (order must match your desired display)
  const COLS = [
    { key: 'PLAYER',  label: 'Player', class: 'col-player left'  },
    { key: 'YEAR',    label: 'Year',   class: 'col-year'   },
    { key: 'SEASON',  label: 'Season', class: 'col-season' },
    { key: 'PROGRAM', label: 'Program',class: 'col-program'},
    { key: 'TEAM',    label: 'Team',   class: 'col-team left' },

    { key: 'GP',  label: 'GP',  class: 'col-gp'  },
    { key: 'PA',  label: 'PA',  class: 'col-pa'  },
    { key: 'AB',  label: 'AB',  class: 'col-ab'  },
    { key: 'R',   label: 'R',   class: 'col-r'   },
    { key: 'H',   label: 'H',   class: 'col-h'   },
    { key: '1B',  label: '1B',  class: 'col-1b'  },
    { key: '2B',  label: '2B',  class: 'col-2b'  },
    { key: '3B',  label: '3B',  class: 'col-3b'  },
    { key: 'HR',  label: 'HR',  class: 'col-hr'  },
    { key: 'RBI', label: 'RBI', class: 'col-rbi' },
    { key: 'BB',  label: 'BB',  class: 'col-bb'  },
    { key: 'HBP', label: 'HBP', class: 'col-hbp' },
    { key: 'SO',  label: 'SO',  class: 'col-so'  },
    { key: 'SB',  label: 'SB',  class: 'col-sb'  },
    { key: 'K-L', label: 'K-L', class: 'col-kl'  },
    { key: 'SF',  label: 'SF',  class: 'col-sf'  },

    { key: 'AVG', label: 'AVG', class: 'col-avg' },
    { key: 'OBP', label: 'OBP', class: 'col-obp' },
    { key: 'SLG', label: 'SLG', class: 'col-slg' },
    { key: 'OPS', label: 'OPS', class: 'col-ops' },
  ];

  let RAW = [];
  let VIEW = [];
  let sortKey = null, sortAsc = true;

  const sel = id => document.getElementById(id);
  const val = id => sel(id).value;
  const uniq = arr => [...new Set(arr.filter(Boolean))];
  const toNum = v => (v === null || v === undefined || v === '') ? 0 : Number(v);
  const numish = v => isNaN(Number(v)) ? (''+v).toLowerCase() : Number(v);
  const rate = v => (v===undefined||v==='') ? '' : String(v).replace(/^0\./,'.');
  const td = (v, cls='') => `<td class="${cls}">${v ?? ''}</td>`;
  function escapeHtml(s=''){return s.replace(/[&<>"']/g, m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m]));}
  const tdPlayer = (name) => `<td class="left col-player"><a class="player-link" href="javascript:void(0)" onclick="filterByPlayer('${escapeHtml(name)}')">${escapeHtml(name)}</a></td>`;

  function buildHeader() {
    const thead = sel('thead');
    const tr = document.createElement('tr');
    COLS.forEach((c, idx) => {
      const th = document.createElement('th');
      th.textContent = c.label;
      th.className = `${c.class} sortable`;
      th.dataset.key = c.key;
      th.dataset.colidx = idx;
      th.addEventListener('click', () => {
        if (sortKey === c.key) { sortAsc = !sortAsc; } else { sortKey = c.key; sortAsc = true; }
        renderBody();
      });
      tr.appendChild(th);
    });
    thead.innerHTML = '';
    thead.appendChild(tr);
  }

  function wireHover() {
    const tbody = sel('tbody');
    const thead = sel('thead');
    tbody.addEventListener('mousemove', (e) => {
      const cell = e.target.closest('td');
      if (!cell) return;
      const idx = [...cell.parentNode.children].indexOf(cell);
      tbody.querySelectorAll('.hover-col').forEach(td => td.classList.remove('hover-col'));
      thead.querySelectorAll('.hover-head').forEach(th => th.classList.remove('hover-head'));
      tbody.querySelectorAll(`td:nth-child(${idx+1})`).forEach(td => td.classList.add('hover-col'));
      thead.querySelector(`th:nth-child(${idx+1})`)?.classList.add('hover-head');
    });
    tbody.addEventListener('mouseleave', () => {
      tbody.querySelectorAll('.hover-col').forEach(td => td.classList.remove('hover-col'));
      thead.querySelectorAll('.hover-head').forEach(th => th.classList.remove('hover-head'));
    });
  }

  function fillSelect(selectEl, values, allLabel) {
    selectEl.innerHTML = '';
    const optAll = document.createElement('option');
    optAll.value = '';
    optAll.textContent = allLabel;
    selectEl.appendChild(optAll);
    values.sort((a,b)=> (''+a).localeCompare(''+b)).forEach(v => {
      const o = document.createElement('option');
      o.value = v;
      o.textContent = v;
      selectEl.appendChild(o);
    });
  }

  function buildFilters() {
    fillSelect(sel('filter-year'),    uniq(RAW.map(r => r.YEAR)),    'All Years');
    fillSelect(sel('filter-season'),  uniq(RAW.map(r => r.SEASON)),  'All Seasons');
    fillSelect(sel('filter-program'), uniq(RAW.map(r => r.PROGRAM)), 'All Programs');
    fillSelect(sel('filter-team'),    uniq(RAW.map(r => r.TEAM)),    'All Teams');
    fillSelect(sel('filter-player'),  uniq(RAW.map(r => r.PLAYER)),  'All Players');

    ['filter-year','filter-season','filter-program','filter-team','filter-player']
      .forEach(id => sel(id).addEventListener('change', onFilterChange));

    sel('btn-reset').addEventListener('click', () => {
      ['filter-year','filter-season','filter-program','filter-team','filter-player']
        .forEach(id => sel(id).selectedIndex = 0);
      onFilterChange();
    });

    sel('btn-clear-player').addEventListener('click', () => {
      sel('filter-player').selectedIndex = 0;
      onFilterChange();
    });

    updateClearPlayerState();
  }

  function onFilterChange() {
    applyFilters();
    updateClearPlayerState();
  }

  function updateClearPlayerState() {
    const hasPlayer = !!val('filter-player');
    sel('btn-clear-player').disabled = !hasPlayer;
  }

  function applyFilters() {
    const y  = val('filter-year');
    const s  = val('filter-season');
    const pr = val('filter-program');
    const t  = val('filter-team');
    const pl = val('filter-player');

    VIEW = RAW.filter(r =>
      (!y || r.YEAR == y) &&
      (!s || r.SEASON == s) &&
      (!pr || r.PROGRAM == pr) &&
      (!t || r.TEAM == t) &&
      (!pl || r.PLAYER == pl)
    );
    renderBody();
  }

  // Clickable player name => sets dropdown
  function filterByPlayer(name) {
    const playerSel = sel('filter-player');
    [...playerSel.options].forEach((o,i)=>{ if (o.value === name) playerSel.selectedIndex = i; });
    onFilterChange();
  }
  window.filterByPlayer = filterByPlayer; // expose to inline onclick

  function renderBody() {
    const tbody = sel('tbody');
    const tfoot = sel('tfoot');

    let rows = VIEW.slice();
    if (sortKey) {
      rows.sort((a,b) => {
        const k = sortKey;
        const va = numish(a[k]); const vb = numish(b[k]);
        if (va < vb) return sortAsc ? -1 : 1;
        if (va > vb) return sortAsc ? 1 : -1;
        return 0;
      });
    }

    tbody.innerHTML = rows.map(r => {
      return `<tr>
        ${tdPlayer(r.PLAYER)}
        ${td(r.YEAR,'col-year')}
        ${td(r.SEASON,'col-season')}
        ${td(r.PROGRAM,'col-program')}
        ${td(r.TEAM,'col-team left')}

        ${td(r.GP,'col-gp')}
        ${td(r.PA,'col-pa')}
        ${td(r.AB,'col-ab')}
        ${td(r.R,'col-r')}
        ${td(r.H,'col-h')}
        ${td(r['1B'],'col-1b')}
        ${td(r['2B'],'col-2b')}
        ${td(r['3B'],'col-3b')}
        ${td(r.HR,'col-hr')}
        ${td(r.RBI,'col-rbi')}
        ${td(r.BB,'col-bb')}
        ${td(r.HBP,'col-hbp')}
        ${td(r.SO,'col-so')}
        ${td(r.SB,'col-sb')}
        ${td(r['K-L'],'col-kl')}
        ${td(r.SF,'col-sf')}

        ${td(rate(r.AVG),'col-avg')}
        ${td(rate(r.OBP),'col-obp')}
        ${td(rate(r.SLG),'col-slg')}
        ${td(rate(r.OPS),'col-ops')}
      </tr>`;
    }).join('');

    // Totals (counting stats only)
    const sum = (k) => rows.reduce((acc, r) => acc + (toNum(r[k])||0), 0);
    const tot = {
      GP: sum('GP'), PA: sum('PA'), AB: sum('AB'), R: sum('R'), H: sum('H'),
      '1B': sum('1B'), '2B': sum('2B'), '3B': sum('3B'), HR: sum('HR'),
      RBI: sum('RBI'), BB: sum('BB'), HBP: sum('HBP'), SO: sum('SO'),
      SB: sum('SB'), 'K-L': sum('K-L'), SF: sum('SF')
    };

    tfoot.innerHTML = `<tr>
      <td class="left col-player"><strong>Totals</strong></td>
      <td class="col-year"></td>
      <td class="col-season"></td>
      <td class="col-program"></td>
      <td class="col-team left"></td>

      ${td(tot.GP,'col-gp')}
      ${td(tot.PA,'col-pa')}
      ${td(tot.AB,'col-ab')}
      ${td(tot.R,'col-r')}
      ${td(tot.H,'col-h')}
      ${td(tot['1B'],'col-1b')}
      ${td(tot['2B'],'col-2b')}
      ${td(tot['3B'],'col-3b')}
      ${td(tot.HR,'col-hr')}
      ${td(tot.RBI,'col-rbi')}
      ${td(tot.BB,'col-bb')}
      ${td(tot.HBP,'col-hbp')}
      ${td(tot.SO,'col-so')}
      ${td(tot.SB,'col-sb')}
      ${td(tot['K-L'],'col-kl')}
      ${td(tot.SF,'col-sf')}

      <td class="col-avg"></td>
      <td class="col-obp"></td>
      <td class="col-slg"></td>
      <td class="col-ops"></td>
    </tr>`;

    wireHover();
  }

  // Load data
  fetch(CSV_URL, { cache: 'no-store' })
    .then(r => {
      if (!r.ok) throw new Error('CSV not found at ' + CSV_URL);
      return r.text();
    })
    .then(txt => new Promise(res => Papa.parse(txt, { header:true, skipEmptyLines:true, complete: res })))
    .then(results => {
      const rows = results.data.map(row => {
        const o = {};
        Object.keys(row).forEach(k => { o[k.trim()] = row[k]; });
        ['GP','PA','AB','R','H','1B','2B','3B','HR','RBI','BB','HBP','SO','SB','K-L','SF']
          .forEach(k => { o[k] = o[k] === '' || o[k] === undefined ? '' : Number(o[k]); });
        return o;
      });

      RAW = rows;
      buildHeader();
      buildFilters();
      VIEW = RAW.slice();
      renderBody();
    })
    .catch(err => {
      console.error(err);
      sel('tbody').innerHTML =
        `<tr><td class="left" colspan="${COLS.length}">Unable to load CSV (“${CSV_URL}”). Check the filename and commit. ${err.message}</td></tr>`;
    });
</script>