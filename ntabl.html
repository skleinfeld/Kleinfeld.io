---
layout: default
title: NTABL — Interactive Hitting Stats
permalink: /ntabl/
---

<section class="wrap-wide" style="padding:40px 0;">
  <h1 style="font-size:22px;font-weight:700;margin:0 0 18px">NTABL</h1>

  <!-- Controls -->
  <div class="card" style="margin:0 auto 16px;padding:16px;display:flex;gap:12px;flex-wrap:wrap;align-items:center">
    <div>
      <label for="f-year" style="display:block;font-size:12px;color:#a5adb6;margin-bottom:6px">Year</label>
      <select id="f-year" class="ntabl-select"></select>
    </div>
    <div>
      <label for="f-season" style="display:block;font-size:12px;color:#a5adb6;margin-bottom:6px">Season</label>
      <select id="f-season" class="ntabl-select"></select>
    </div>
    <div>
      <label for="f-division" style="display:block;font-size:12px;color:#a5adb6;margin-bottom:6px">Division</label>
      <select id="f-division" class="ntabl-select"></select>
    </div>
    <div>
      <label for="f-team" style="display:block;font-size:12px;color:#a5adb6;margin-bottom:6px">Team</label>
      <select id="f-team" class="ntabl-select"></select>
    </div>

    <div style="margin-left:auto;display:flex;gap:8px;align-items:flex-end">
      <div id="player-chip" style="display:none;align-items:center;gap:8px;background:#181b20;border:1px solid #2b2f35;border-radius:12px;padding:8px 10px">
        <span style="font-size:12px;color:#a5adb6">Player:</span>
        <strong id="player-name" style="font-size:13px">—</strong>
        <button id="btn-clear-player" class="btn alt" type="button" style="padding:6px 10px;border-radius:10px">Clear Player</button>
      </div>
      <button id="btn-reset" class="btn" type="button" style="background:linear-gradient(180deg,#2f3541,#20242c)">Reset Filters</button>
    </div>
  </div>

  <!-- Table -->
  <div class="surface" style="margin:0 auto;">
    <div class="ntabl-wrap">
      <table id="ntabl-table" class="ntabl-table" aria-describedby="ntabl-note">
        <thead></thead>
        <tbody></tbody>
        <tfoot></tfoot>
      </table>
    </div>
    <div id="ntabl-note" style="font-size:12px;color:#667085;padding:10px 12px 14px">
      Hover to highlight row &amp; column. Click a player name to filter to that player. Click headers to sort.
    </div>
  </div>
</section>

<!-- PapaParse for CSV -->
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<style>
/* modern compact selects */
.ntabl-select{
  appearance:none; -webkit-appearance:none; -moz-appearance:none;
  background:#0f1113;
  color:#e9eaec;
  border:1px solid #222428;
  border-radius:12px;
  padding:10px 12px;
  min-width:160px;
  font-weight:600;
}
.ntabl-select:focus{outline:none;border-color:#2b2f35;box-shadow:0 0 0 3px rgba(124,58,237,.28)}

/* row & column hover highlighting */
.ntabl-table tbody tr:hover td{ background:#eef2f7 !important; }
.ntabl-table thead th.col-hover,
.ntabl-table tbody td.col-hover,
.ntabl-table tfoot td.col-hover{
  background:#e6eaf1 !important;
}

/* link-look buttons for player names */
.link-like{
  background:none;border:none;color:#2563eb;cursor:pointer;padding:0;font-weight:700;
}
.link-like:hover{ text-decoration:underline; }
</style>

<script>
(function(){
  /* -------------------- CONFIG -------------------- */
  const CSV_PATH = "/ntabl-hitting-stats.csv";

  // Known columns / order (we'll build dynamically but prefer this order)
  const PREFERRED = [
    'Player','Year','Season','Division','Team',
    'GP','PA','AB','R','H','1B','2B','3B','HR','RBI','BB','HBP','SO','K-L','SB','TB','AVG','OBP','SLG','OPS','SF','SAC'
  ];
  const METRICS = new Set(['AVG','OBP','SLG','OPS']);
  const TEXT_COLS = new Set(['Player','Year','Season','Division','Team']);

  // Filter ordering
  const ORDER_YEAR = ['2025','2024'];
  const ORDER_SEASON = ['Summer','Fall','Spring'];

  /* -------------------- DOM -------------------- */
  const table = document.getElementById('ntabl-table');
  const theadEl = table.querySelector('thead');
  const tbodyEl = table.querySelector('tbody');
  const tfootEl = table.querySelector('tfoot');

  const fYear = document.getElementById('f-year');
  const fSeason = document.getElementById('f-season');
  const fDivision = document.getElementById('f-division');
  const fTeam = document.getElementById('f-team');

  const btnReset = document.getElementById('btn-reset');
  const playerChip = document.getElementById('player-chip');
  const playerNameEl = document.getElementById('player-name');
  const btnClearPlayer = document.getElementById('btn-clear-player');

  /* -------------------- STATE -------------------- */
  let rows = [];        // normalized with Player + Year/Season derived
  let viewRows = [];    // filtered
  let COLS = [];        // resolved columns present in CSV (ordered)
  let sortKey = null;
  let sortDir = 1;
  let currentPlayer = ""; // set when clicking a player

  /* -------------------- HELPERS -------------------- */
  const norm = s => String(s||'').trim();
  const lower = s => norm(s).toLowerCase();
  const numLike = v => v !== '' && v !== null && !isNaN(v);
  const to3 = v => Number(v).toFixed(3).replace(/^0/,'');

  function titleCase(s){return norm(s).replace(/\b(\w)/g, m => m.toUpperCase());}

  // derive Year/Season from a Season string like "Summer 2025"
  function splitSeasonYear(v){
    const m = String(v||'').match(/(Summer|Fall|Spring)\s+(\d{4})/i);
    return m ? {season:titleCase(m[1].toLowerCase()), year:m[2]} : {season:'',year:''};
  }

  function setOptions(sel, list, labelAll){
    sel.innerHTML = '';
    const all = document.createElement('option');
    all.value=''; all.textContent=labelAll; sel.appendChild(all);
    list.forEach(v=>{
      const o=document.createElement('option'); o.value=v; o.textContent=v; sel.appendChild(o);
    });
  }

  function totalsFor(rows, cols){
    const t={}; cols.forEach(c=>t[c]=TEXT_COLS.has(c)?'':0);
    rows.forEach(r=>{
      cols.forEach(c=>{
        if(TEXT_COLS.has(c) || METRICS.has(c)) return;
        if(numLike(r[c])) t[c]+= (+r[c]||0);
      });
    });
    return t;
  }

  function compare(a,b,k){
    const av=a[k], bv=b[k];
    const an=numLike(av), bn=numLike(bv);
    if(an&&bn) return (av-bv)*sortDir;
    return String(av||'').localeCompare(String(bv||''))*sortDir;
  }

  /* -------------------- BUILD TABLE -------------------- */
  function buildHead(){
    theadEl.innerHTML = '<tr>'+COLS.map(c=>{
      const cls = TEXT_COLS.has(c)?'t-text':'t-num';
      const arrow = (sortKey===c)?(sortDir>0?' ▲':' ▼'):'';
      return `<th data-col="${c}" class="${cls}" style="cursor:pointer" title="Sort by ${c}">${c}${arrow}</th>`;
    }).join('')+'</tr>';

    // sort handlers
    theadEl.querySelectorAll('th').forEach(th=>{
      th.addEventListener('click',()=>{
        const k = th.getAttribute('data-col');
        if(sortKey===k) sortDir*=-1; else { sortKey=k; sortDir=1; }
        renderBody();
        buildHead(); // refresh arrows
      });
    });
  }

  function buildBodyRows(data){
    return data.map(r=>{
      return '<tr>'+COLS.map((c,idx)=>{
        let v = r[c] ?? '';
        if(METRICS.has(c) && numLike(v)) v = to3(v);

        // Link player name for filtering
        if(c==='Player' && v){
          v = `<button class="link-like player-link" data-player="${escapeHtml(String(v))}" title="Filter to ${escapeHtml(String(v))}">${escapeHtml(String(v))}</button>`;
        }
        const cls = TEXT_COLS.has(c)?'t-text':'t-num';
        return `<td class="${cls}" data-col-idx="${idx}">${v}</td>`;
      }).join('')+'</tr>';
    }).join('');
  }

  function renderBody(){
    let data = viewRows.slice();
    if(sortKey){ data.sort((a,b)=>compare(a,b,sortKey)); }

    tbodyEl.innerHTML = buildBodyRows(data);

    // totals
    const t = totalsFor(data, COLS);
    tfootEl.innerHTML = '<tr>'+COLS.map((c,i)=>{
      if(i===0) return '<th scope="row" class="t-text">Totals</th>';
      const cls = TEXT_COLS.has(c)?'t-text':'t-num';
      return `<td class="${cls}">${numLike(t[c])?t[c]:''}</td>`;
    }).join('')+'</tr>';

    // attach player-link handlers
    tbodyEl.querySelectorAll('.player-link').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        currentPlayer = btn.getAttribute('data-player');
        playerNameEl.textContent = currentPlayer;
        playerChip.style.display = 'flex';
        applyFilters();
      });
    });
  }

  /* -------------------- ROW/COLUMN HOVER -------------------- */
  // Column highlight on hover
  tbodyEl.addEventListener('mouseover', (e)=>{
    const cell = e.target.closest('td');
    if(!cell) return;
    const idx = +cell.getAttribute('data-col-idx');
    if(isNaN(idx)) return;

    // add col-hover to this column cells + header + footer
    markColumn(idx, true);
  });
  tbodyEl.addEventListener('mouseout', (e)=>{
    const cell = e.target.closest('td');
    if(!cell) return;
    const idx = +cell.getAttribute('data-col-idx');
    if(isNaN(idx)) return;
    markColumn(idx, false);
  });

  function markColumn(idx, on){
    const selector = `td[data-col-idx="${idx}"]`;
    tbodyEl.querySelectorAll(selector).forEach(td=>td.classList.toggle('col-hover', on));
    const th = theadEl.querySelectorAll('th')[idx];
    if(th) th.classList.toggle('col-hover', on);
    const tf = tfootEl.querySelectorAll('td')[idx-1]; // -1 because first is th "Totals"
    if(tf) tf.classList.toggle('col-hover', on);
  }

  /* -------------------- FILTERS -------------------- */
  function applyFilters(){
    const y = fYear.value;
    const s = fSeason.value;
    const d = lower(fDivision.value);
    const t = fTeam.value;

    viewRows = rows.filter(r=>{
      if(currentPlayer && r.Player !== currentPlayer) return false;
      if(y && String(r.Year)!==y) return false;
      if(s && String(r.Season)!==s) return false;
      if(d && !lower(r.Division).includes(d)) return false;
      if(t && String(r.Team)!==t) return false;
      return true;
    });
    renderBody();
  }

  function resetFilters(){
    currentPlayer = "";
    playerChip.style.display = 'none';
    fYear.value=''; fSeason.value=''; fDivision.value=''; fTeam.value='';
    applyFilters();
  }

  btnReset.addEventListener('click', resetFilters);
  btnClearPlayer.addEventListener('click', ()=>{
    currentPlayer = "";
    playerChip.style.display = 'none';
    applyFilters();
  });

  /* -------------------- CSV LOAD -------------------- */
  Papa.parse(CSV_PATH, {
    download:true, header:true, dynamicTyping:true, skipEmptyLines:'greedy',
    complete: res => {
      const raw = res.data || [];

      // Normalize: ensure Player, Year, Season exist
      rows = raw.map(r=>{
        const obj = {...r};

        // Player column detection or construction
        const hasPlayer = !!obj.Player || !!obj.NAME || (!!obj.First && !!obj.Last);
        if(!obj.Player){
          if(obj.NAME) obj.Player = norm(obj.NAME);
          else if(obj.First && obj.Last) obj.Player = norm(`${obj.First} ${obj.Last}`);
          else obj.Player = hasPlayer ? norm(obj.Player) : ''; // fallback
        } else {
          obj.Player = norm(obj.Player);
        }

        // Year / Season
        if(!obj.Year || !obj.Season){
          const parsed = splitSeasonYear(obj.Season || obj.SEASON || '');
          obj.Season = obj.Season || parsed.season;
          obj.Year = obj.Year || parsed.year;
        } else {
          obj.Season = titleCase(obj.Season);
          obj.Year = String(obj.Year);
        }

        // Standardize common columns casing
        if(obj.Team===undefined && obj.TEAM!==undefined) obj.Team = obj.TEAM;
        if(obj.Division===undefined && obj.DIVISION!==undefined) obj.Division = obj.DIVISION;

        return obj;
      });

      // Resolve columns = intersection of preferred + actually present in data
      const present = new Set(Object.keys(rows[0]||{}));
      COLS = PREFERRED.filter(c => present.has(c));

      // Build filters
      const years = Array.from(new Set(rows.map(r=>r.Year).filter(Boolean)))
        .sort((a,b)=>ORDER_YEAR.indexOf(a)-ORDER_YEAR.indexOf(b));
      const seasons = Array.from(new Set(rows.map(r=>r.Season).filter(Boolean)))
        .sort((a,b)=>ORDER_SEASON.indexOf(a)-ORDER_SEASON.indexOf(b));
      const divisions = Array.from(new Set(rows.map(r=>r.Division).filter(Boolean))).sort();
      const teams = Array.from(new Set(rows.map(r=>r.Team).filter(Boolean))).sort();

      setOptions(fYear, years, 'All Years');
      setOptions(fSeason, seasons, 'All Seasons');
      setOptions(fDivision, divisions, 'All Divisions');
      setOptions(fTeam, teams, 'All Teams');

      // Build table
      buildHead();
      viewRows = rows.slice();
      renderBody();

      // Hook filter changes
      fYear.addEventListener('change', applyFilters);
      fSeason.addEventListener('change', applyFilters);
      fDivision.addEventListener('change', applyFilters);
      fTeam.addEventListener('change', applyFilters);
    },
    error: err => {
      theadEl.innerHTML = '<tr><th>Error</th></tr>';
      tbodyEl.innerHTML = `<tr><td style="padding:12px 14px;color:#c00">Unable to load CSV (${err?.message||'unknown error'}). Check <code>${CSV_PATH}</code>.</td></tr>`;
      tfootEl.innerHTML = '';
    }
  });

  /* -------------------- UTIL -------------------- */
  function escapeHtml(s){
    return String(s).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
  }
})();
</script>