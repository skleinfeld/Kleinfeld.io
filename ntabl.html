---
layout: default
title: NTABL
permalink: /ntabl/
---

<section class="relative overflow-hidden">
  <div class="pointer-events-none absolute inset-0 -z-10">
    <div class="absolute -top-40 left-1/2 -translate-x-1/2 h-[520px] w-[1200px] rounded-full blur-3xl"
         style="background:radial-gradient(ellipse at center, rgba(10,132,255,.18), rgba(191,90,242,.12) 45%, transparent 65%)"></div>
  </div>

  <div class="wrap mx-auto px-4 sm:px-6 py-10">
    <div class="flex items-center gap-4">
      <img src="{{ "NTABL - Gann's Bulls Logo.png" | relative_url | uri_escape }}" alt="Gann’s Bulls"
           class="h-12 w-12 rounded bg-white object-contain p-1">
      <div>
        <h1 class="text-2xl sm:text-3xl font-semibold leading-tight">NTABL</h1>
        <p class="text-d-sub text-[14px]">Personal and Team statistics</p>
      </div>

      <div class="ml-auto flex items-center gap-2">
        <label for="season" class="text-[13px] text-d-sub">Season</label>
        <select id="season" class="bg-transparent border border-d-line rounded-full px-3 py-1.5 text-sm">
          <option value="summer2024">Summer 2024</option>
          <option value="summer2025">Summer 2025</option>
          <option value="fall2025">Fall 2025</option>
          <option value="career">Career</option>
        </select>
      </div>
    </div>

    <!-- Primary tabs -->
    <div class="mt-6 rounded-2xl border border-d-line bg-d-card overflow-hidden">
      <div class="flex gap-1 border-b border-d-line px-2 pt-2">
        <button data-tab="individual" class="tab-primary active">Individual</button>
        <button data-tab="game" class="tab-primary">Game-by-Game</button>
        <button data-tab="leaders" class="tab-primary">Leaders</button>
      </div>

      <!-- Secondary tabs -->
      <div class="flex gap-1 border-b border-d-line px-2 pt-2">
        <button data-sub="batting"  class="tab-sub active">Batting</button>
        <button data-sub="pitching" class="tab-sub">Pitching</button>
        <button data-sub="fielding" class="tab-sub">Fielding</button>
      </div>

      <!-- Switch: Personal vs Team -->
      <div class="flex gap-2 px-3 py-3 border-b border-d-line">
        <button id="btn-personal" class="px-4 py-2 text-sm rounded-full bg-white text-black">Personal Stats</button>
        <button id="btn-team" class="px-4 py-2 text-sm rounded-full border border-d-line hover:bg-white/5">Team Stats</button>
      </div>

      <!-- Table -->
      <div class="p-0">
        <div class="overflow-x-auto">
          <table class="min-w-[1100px] w-full text-sm">
            <thead id="tbl-head" class="bg-white/5 sticky top-[calc(56px+56px+56px)] z-10"></thead>
            <tbody id="tbl-body"></tbody>
            <tfoot id="tbl-foot"></tfoot>
          </table>
        </div>
      </div>
    </div>

    <p class="mt-3 text-d-sub text-[12px]">
      Derived metrics when columns exist: AVG = H/AB • OBP = (H+BB+HBP)/(AB+BB+HBP+SF) • SLG = TB/AB • OPS = OBP+SLG.
    </p>
  </div>
</section>

<style>
  .tab-primary{ @apply px-4 py-2 text-sm rounded-t-md border border-d-line border-b-0 bg-d-card/50 hover:bg-white/5; }
  .tab-primary.active{ @apply bg-white text-black; }
  .tab-sub{ @apply px-3 py-1.5 text-sm rounded-t-md border border-d-line border-b-0 bg-d-card/50 hover:bg-white/5; }
  .tab-sub.active{ @apply bg-white/10; }
</style>

<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<script>
/* --------------------- FILE MAP (rename your CSVs to these safe names) --------------------- */
const files = {
  personal: {
    batting: {
      individual:  { summer2024: "{{ 'personal-batting-summer-2024.csv' | relative_url }}",
                     summer2025: "{{ 'personal-batting-summer-2025.csv' | relative_url }}",
                     fall2025:   "{{ 'personal-batting-fall-2025.csv'   | relative_url }}",
                     career:     "{{ 'personal-batting-career.csv'       | relative_url }}" },
      game:        { summer2024: "{{ 'personal-batting-summer-2024.csv' | relative_url }}",
                     summer2025: "{{ 'personal-batting-summer-2025.csv' | relative_url }}",
                     fall2025:   "{{ 'personal-batting-fall-2025.csv'   | relative_url }}",
                     career:     "{{ 'personal-batting-career.csv'       | relative_url }}" },
      leaders:     { career:     "{{ 'personal-batting-career.csv'       | relative_url }}" }
    },
    pitching: { /* wire later */ },
    fielding: { /* wire later */ }
  },
  team: {
    batting: {
      individual:  { summer2024: "{{ 'team-batting-summer-2024.csv' | relative_url }}",
                     summer2025: "{{ 'team-batting-summer-2025.csv' | relative_url }}",
                     fall2025:   "{{ 'team-batting-fall-2025.csv'   | relative_url }}",
                     career:     "{{ 'team-batting-career.csv'       | relative_url }}" },
      game:        { summer2024: "{{ 'team-batting-summer-2024.csv' | relative_url }}",
                     summer2025: "{{ 'team-batting-summer-2025.csv' | relative_url }}",
                     fall2025:   "{{ 'team-batting-fall-2025.csv'   | relative_url }}",
                     career:     "{{ 'team-batting-career.csv'       | relative_url }}" },
      leaders:     { career:     "{{ 'team-batting-career.csv'       | relative_url }}" }
    },
    pitching: { /* wire later */ },
    fielding: { /* wire later */ }
  }
};
/* ------------------------------------------------------------------------------------------ */

let state = {
  top: 'individual',   // 'individual' | 'game' | 'leaders'
  sub: 'batting',      // 'batting' | 'pitching' | 'fielding'
  who: 'personal',     // 'personal' | 'team'
  season: 'summer2024'
};

const $ = sel => document.querySelector(sel);
const $$ = sel => Array.from(document.querySelectorAll(sel));

const thead = $('#tbl-head'), tbody = $('#tbl-body'), tfoot = $('#tbl-foot');

function syncButtons(){
  // primary
  $$('.tab-primary').forEach(b => b.classList.toggle('active', b.dataset.tab === state.top));
  // sub
  $$('.tab-sub').forEach(b => b.classList.toggle('active', b.dataset.sub === state.sub));
  // personal/team
  const bp = $('#btn-personal'), bt = $('#btn-team');
  bp.className = state.who==='personal' ? 'px-4 py-2 text-sm rounded-full bg-white text-black'
                                        : 'px-4 py-2 text-sm rounded-full border border-d-line hover:bg-white/5';
  bt.className = state.who==='team'     ? 'px-4 py-2 text-sm rounded-full bg-white text-black'
                                        : 'px-4 py-2 text-sm rounded-full border border-d-line hover:bg-white/5';
  // select
  $('#season').value = state.season;
}

function fileForCurrent(){
  const branch = files[state.who][state.sub][state.top];
  // fallback to career if season not defined in the branch
  return (branch && (branch[state.season] || branch['career'])) || null;
}

function fetchCSV(url){
  return new Promise((resolve, reject) => {
    Papa.parse(url, {
      download: true,
      header: true,
      dynamicTyping: true,
      skipEmptyLines: 'greedy',
      complete: r => resolve(r.data),
      error: reject
    });
  });
}

const fmt3 = n => (isNaN(n) ? '—' : Number(n).toFixed(3).replace(/^0/,''));
const divz = (n,d) => d>0 ? n/d : 0;

function computeDerived(rows){
  if(!rows || !rows.length) return rows;
  const keys = Object.keys(rows[0]);
  const has = k => keys.includes(k);

  return rows.map(r => {
    const H   = +r['H']   || 0;
    const AB  = +r['AB']  || 0;
    const BB  = +r['BB']  || 0;
    const HBP = +r['HBP'] || 0;
    const _1B = +r['1B']  || 0;
    const _2B = +r['2B']  || 0;
    const _3B = +r['3B']  || 0;
    const HR  = +r['HR']  || 0;
    const SF  = +r['SF']  || 0;
    const TB  = _1B + 2*_2B + 3*_3B + 4*HR;

    const AVG = has('H') && has('AB') ? fmt3(divz(H, AB)) : r['AVG'] || '—';
    const OBP = (has('AB') && (has('BB')||has('HBP'))) ? fmt3(divz((H+BB+HBP),(AB+BB+HBP+SF))) : r['OBP'] || '—';
    const SLG = (has('AB') && (has('1B')||has('2B')||has('3B')||has('HR'))) ? fmt3(divz(TB, AB)) : r['SLG'] || '—';
    const OPS = (!isNaN(parseFloat(OBP)) && !isNaN(parseFloat(SLG))) ? fmt3(parseFloat(OBP)+parseFloat(SLG)) : r['OPS'] || '—';

    return { ...r, AVG, OBP, SLG, OPS };
  });
}

function buildTable(rows){
  if(!rows || !rows.length){
    thead.innerHTML = tbody.innerHTML = tfoot.innerHTML =
      '<tr><td class="px-4 py-3">No data found.</td></tr>';
    return;
  }

  const cols = Object.keys(rows[0]);

  // head
  thead.innerHTML = '<tr class="text-left">' + cols.map(c =>
    `<th class="px-3 py-3 border-b border-d-line">${c}</th>`).join('') + '</tr>';

  // body
  tbody.innerHTML = rows.map((r,i) => {
    const stripe = i%2 ? 'bg-white/[.03] hover:bg-white/[.06]' : 'hover:bg-white/[.06]';
    return `<tr class="${stripe}">` + cols.map(c =>
      `<td class="px-3 py-2.5 border-t border-d-line">${r[c] ?? ''}</td>`).join('') + `</tr>`;
  }).join('');

  // totals for numeric columns
  const numeric = new Set();
  rows.forEach(r => Object.entries(r).forEach(([k,v])=>{
    if(v!=='' && v!==null && !isNaN(v)) numeric.add(k);
  }));
  if(numeric.size){
    const totals = {};
    numeric.forEach(k => totals[k] = rows.reduce((a,r)=>a+(+r[k]||0),0));
    tfoot.innerHTML = '<tr class="bg-white/5">' +
      cols.map((c,idx)=> idx===0
        ? `<th class="px-3 py-3 border-t border-d-line text-left">Totals</th>`
        : `<th class="px-3 py-3 border-t border-d-line text-left">${totals[c] ?? ''}</th>`
      ).join('') + '</tr>';
  } else {
    tfoot.innerHTML = '';
  }
}

async function render(){
  syncButtons();
  const url = fileForCurrent();
  if(!url){
    thead.innerHTML = tbody.innerHTML = tfoot.innerHTML =
      '<tr><td class="px-4 py-3">No data source mapped.</td></tr>';
    return;
  }
  try{
    const data = await fetchCSV(url);
    const rows = computeDerived(data);
    buildTable(rows);
  }catch(e){
    console.error('CSV load error', e);
    thead.innerHTML = tbody.innerHTML = tfoot.innerHTML =
      '<tr><td class="px-4 py-3">Unable to load CSV.</td></tr>';
  }
}

/* events */
$$('.tab-primary').forEach(b => b.addEventListener('click', ()=>{
  state.top = b.dataset.tab; render();
}));
$$('.tab-sub').forEach(b => b.addEventListener('click', ()=>{
  state.sub = b.dataset.sub; render();
}));
$('#btn-personal').addEventListener('click', ()=>{ state.who='personal'; render(); });
$('#btn-team').addEventListener('click', ()=>{ state.who='team'; render(); });
$('#season').addEventListener('change', e => { state.season = e.target.value; render(); });

render();
</script>