---
layout: default
title: NTABL â€” Career Batting
permalink: /ntabl/
---

<section class="wrap mx-auto max-w-[1400px] px-4 sm:px-6 py-6">
  <div class="border border-d-line bg-d-card rounded-2xl shadow-card p-4 mb-4">
    <h1 class="text-xl font-semibold mb-1">NTABL</h1>
    <p class="text-d-sub text-[13px]">Career batting table loaded from Excel (dark header, white body).</p>
  </div>

  <div class="ntabl-card">
    <div class="ntabl-table-wrap">
      <table id="ntabl-table" class="ntabl-table" aria-describedby="ntabl-note">
        <thead></thead>
        <tbody></tbody>
        <tfoot></tfoot>
      </table>
    </div>
    <div id="ntabl-note" class="ntabl-note">
      Derived metrics shown if provided by the sheet (AVG, OBP, SLG, OPS).
    </div>
  </div>
</section>

<style>
  /* Table theme: dark header, white body */
  .ntabl-card{
    border:1px solid #e6e6e6; border-radius:14px; background:#fff;
    box-shadow:0 8px 24px rgba(0,0,0,.08); overflow:hidden;
  }
  .ntabl-table-wrap{ overflow-x:auto; }
  .ntabl-table{ width:100%; min-width:1100px; border-collapse:separate; border-spacing:0; font-size:14px; }
  .ntabl-table thead th{
    position:sticky; top:0; z-index:2;
    background:#111; color:#fff; font-weight:600; text-align:left;
    padding:12px 14px; border-bottom:1px solid #222; white-space:nowrap;
  }
  .ntabl-table tbody td{
    background:#fff; color:#111; padding:12px 14px; border-top:1px solid #eee; white-space:nowrap;
  }
  .ntabl-table tbody tr:nth-child(even) td{ background:#fafafa; }
  .ntabl-table tbody tr:hover td{ background:#f2f2f2; }
  .ntabl-table tfoot th, .ntabl-table tfoot td{
    background:#f7f7f7; color:#111; font-weight:700; padding:12px 14px; border-top:2px solid #e5e5e5;
  }
  .ntabl-note{ font-size:12px; color:#666; padding:10px 12px 14px; }
</style>

<!-- SheetJS to read .xlsx in the browser -->
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<script>
(function(){
  // IMPORTANT: keep this as an absolute path from your site root
  const XLSX_PATH = "/personal-career-stats.xlsx";

  const table   = document.getElementById('ntabl-table');
  const theadEl = table.querySelector('thead');
  const tbodyEl = table.querySelector('tbody');
  const tfootEl = table.querySelector('tfoot');

  // Preferred baseball column order; extras appended to the end
  const PREFERRED = [
    'Season','Division','Team','Last','First',
    'GP','PA','AB','R','H','1B','2B','3B','HR','RBI',
    'BB','HBP','SO','K-L','SB','SB-ATT','CS','TB','AVG','OBP','SLG','OPS'
  ];

  // Normalize header names
  const normalizeKey = k => String(k).trim().replace(/\u2013|\u2014/g,'-').replace(/\s+/g,' ').toLowerCase();
  const aliases = {
    'season':'Season','division':'Division','team':'Team',
    'last':'Last','first':'First',
    'gp':'GP','g':'GP','gs':'GS','pa':'PA','ab':'AB','r':'R','h':'H',
    '1b':'1B','2b':'2B','3b':'3B','hr':'HR','rbi':'RBI','tb':'TB',
    'bb':'BB','so':'SO','k-l':'K-L','k l':'K-L','hbp':'HBP','sf':'SF',
    'sb':'SB','sb-att':'SB-ATT','sb att':'SB-ATT','cs':'CS',
    'avg':'AVG','obp':'OBP','slg':'SLG','ops':'OPS'
  };

  function normalizeRows(rows){
    return rows.map(row=>{
      const out = {};
      Object.entries(row).forEach(([k,v])=>{
        const key = aliases[normalizeKey(k)] || k;
        out[key] = v;
      });
      return out;
    });
  }

  function orderColumns(rows){
    if(!rows || !rows.length) return [];
    const seen = new Set(), cols = [];
    PREFERRED.forEach(c => { if(c in rows[0]){ cols.push(c); seen.add(c); }});
    Object.keys(rows[0]).forEach(c => { if(!seen.has(c)) cols.push(c); });
    return cols;
  }

  function buildHead(cols){
    theadEl.innerHTML = '<tr>'+cols.map(c=>`<th scope="col">${c}</th>`).join('')+'</tr>';
  }

  const numLike = v => (v!=='' && v!==null && !isNaN(v));
  const metricCol = c => ['AVG','OBP','SLG','OPS'].includes(c);

  function buildBody(cols, rows){
    tbodyEl.innerHTML = rows.map(r=>{
      return '<tr>'+cols.map(c=>{
        let val = r[c] ?? '';
        if(metricCol(c) && numLike(val)){ val = Number(val).toFixed(3).replace(/^0/,''); }
        return `<td>${val}</td>`;
      }).join('')+'</tr>';
    }).join('');
  }

  function buildTotals(cols, rows){
    const totals = {}; cols.forEach(c => totals[c] = '');
    cols.forEach(c=>{
      if(!metricCol(c)){ // sum counting stats only
        let sum = 0, hasAny = false;
        rows.forEach(r=>{ const v=r[c]; if(numLike(v)){ sum += (+v||0); hasAny = true; }});
        if(hasAny) totals[c] = sum;
      }
    });
    tfootEl.innerHTML = '<tr>'+
      cols.map((c,i)=> i===0 ? '<th scope="row">Totals</th>' : `<td>${totals[c] ?? ''}</td>`).join('') +
    '</tr>';
  }

  async function loadXLSX(){
    try{
      const res = await fetch(XLSX_PATH, {cache:'no-store'});
      if(!res.ok) throw new Error(`HTTP ${res.status}`);
      const buf = await res.arrayBuffer();
      const wb = XLSX.read(buf, {type:'array'});
      const ws = wb.Sheets[wb.SheetNames[0]]; // first sheet
      const rows = XLSX.utils.sheet_to_json(ws, {defval:''});
      const norm = normalizeRows(rows);
      if(!norm.length){
        theadEl.innerHTML = '<tr><th>Error</th></tr>';
        tbodyEl.innerHTML = '<tr><td style="padding:12px 14px;color:#c00">No rows found in Excel sheet.</td></tr>';
        tfootEl.innerHTML = '';
        return;
      }
      const cols = orderColumns(norm);
      buildHead(cols);
      buildBody(cols, norm);
      buildTotals(cols, norm);
    }catch(err){
      console.error('XLSX load error:', err);
      theadEl.innerHTML = '<tr><th>Error</th></tr>';
      tbodyEl.innerHTML = `<tr><td style="padding:12px 14px;color:#c00">Unable to load Excel file (${err?.message||'unknown error'}).<br>Check that it exists at <code>${XLSX_PATH}</code>.</td></tr>`;
      tfootEl.innerHTML = '';
    }
  }

  loadXLSX();
})();
</script>