---
layout: default
title: NTABL
permalink: /ntabl
---

<style>
  :root{
    --nw-purple:#4B2E83;
    --accent:#7c3aed;
    --bg:#0b0c0f;
    --panel:#14161b;
    --panel-2:#1a1d23;
    --text:#e6e7ea;
    --muted:#9aa1ad;
    --ring:#2a2f3a;
    --row:#0f1116;
    --row-alt:#12151b;
    --hi:rgba(124,58,237,.14);
    --col:rgba(124,58,237,.20);
    --header:#1d2129;
    --border:#262b35;

    /* compact table sizing so all columns fit */
    --fs-xs: 12px;
    --fs-sm: 13px;
    --pad-y: 6px;
    --pad-x: 8px;

    /* max width shared by title, filters, and table */
    --maxw: 1280px;
  }

  /* page shell */
  .ntabl-shell{
    max-width:var(--maxw);
    margin: 28px auto 64px;
    padding: 0 16px;
  }

  /* title */
  .ntabl-title{
    margin: 0 auto 18px;
    font-size: clamp(18px, 2.6vw, 24px);
    font-weight: 700;
    color: var(--text);
    text-align:center;
    letter-spacing:.2px;
  }

  /* filter bar */
  .filters{
    display:grid;
    grid-template-columns: repeat(5, minmax(0,1fr)) auto;
    gap: 10px;
    align-items:center;
    background: linear-gradient(180deg, var(--panel) 0%, var(--panel-2) 100%);
    border:1px solid var(--ring);
    border-radius:14px;
    padding: 12px;
    margin: 0 auto 16px;
  }
  .filters .group{
    display:flex;
    flex-direction:column;
    gap:6px;
  }
  .filters label{
    font-size:11px;
    color:var(--muted);
    letter-spacing:.3px;
  }
  .filters select, .filters button{
    appearance:none;
    border-radius:10px;
    border:1px solid var(--ring);
    background:#0f1217;
    color:var(--text);
    font-size: var(--fs-sm);
    padding: 10px 12px;
    outline-offset: 2px;
    width:100%;
  }
  .filters button{
    background: #10131a;
    cursor:pointer;
    transition: 120ms ease;
  }
  .filters button:hover{
    border-color: var(--accent);
    background: #121623;
  }

  /* table card */
  .card{
    background: linear-gradient(180deg, var(--panel) 0%, var(--panel-2) 100%);
    border:1px solid var(--ring);
    border-radius:14px;
    overflow:hidden;
  }

  table{
    width:100%;
    border-collapse:separate;
    border-spacing:0;
    table-layout: fixed;        /* fixed column widths */
    font-size: var(--fs-xs);    /* compact text, more columns fit */
  }

  thead th{
    position: sticky;
    top: 0;
    z-index: 2;
    background: var(--header);
    color: var(--text);
    font-weight: 600;
    text-align: center;
    padding: var(--pad-y) var(--pad-x);
    border-bottom: 1px solid var(--border);
    letter-spacing:.2px;
    white-space: nowrap;
  }
  tbody td{
    color: var(--text);
    text-align: center;
    padding: var(--pad-y) var(--pad-x);
    border-bottom:1px solid var(--border);
    background: var(--row);
  }
  tbody tr:nth-child(even) td{
    background: var(--row-alt);
  }

  /* left identity columns a bit left aligned for readability */
  td.c-left, th.c-left{
    text-align:left;
  }

  /* row hover */
  tbody tr:hover td{
    background: var(--hi);
  }

  /* column hover (applied by JS with .col-hover) */
  td.col-hover, th.col-hover{
    background: var(--col) !important;
  }

  /* player link styling */
  .pname{
    color: var(--text);
    text-decoration: none;
    border-bottom: 1px dotted transparent;
    transition: 120ms ease;
  }
  .pname:hover{
    color: #cdd2ff;
    border-bottom-color: currentColor;
  }

  /* totals row */
  tfoot td{
    background:#0f131a;
    color: var(--muted);
    font-weight:600;
    border-top:1px solid var(--border);
  }

  /* vertical group dividers (like MLB) */
  /* column indices: 1 PLAYER,2 YEAR,3 SEASON,4 PROGRAM,5 TEAM,
     6 GP,7 PA,8 AB,9 R,10 H,11 1B,12 2B,13 3B,14 HR,15 RBI,16 BB,17 HBP,
     18 SO,19 SB,20 K-L,21 AVG,22 OBP,23 SLG,24 OPS
  */
  thead th:nth-child(14),
  tbody td:nth-child(14){
    border-left:1px solid var(--border);
  }
  thead th:nth-child(21),
  tbody td:nth-child(21){
    border-left:1px solid var(--border);
  }

  /* keep columns from squeezing */
  th, td{
    overflow:hidden;
    text-overflow: ellipsis;
  }

  /* make the panel & table the same width as filters/title */
  .ntabl-shell > *{
    max-width: var(--maxw);
    margin-left:auto;
    margin-right:auto;
  }

  /* tighter header row height so more data fits */
  thead th{ padding-top:8px; padding-bottom:8px; }

  /* small screens still allow scroll (fallback) */
  @media (max-width: 1180px){
    .ntabl-shell{ padding: 0 10px; }
  }
</style>

<div class="ntabl-shell">
  <h1 class="ntabl-title">North Texas Amateur Baseball League | Interactive Hitting Stats</h1>

  <!-- Filters -->
  <div class="filters" id="filters">
    <div class="group">
      <label for="fYear">Year</label>
      <select id="fYear"><option value="">All Years</option></select>
    </div>
    <div class="group">
      <label for="fSeason">Season</label>
      <select id="fSeason"><option value="">All Seasons</option></select>
    </div>
    <div class="group">
      <label for="fProgram">Program</label>
      <select id="fProgram"><option value="">All Programs</option></select>
    </div>
    <div class="group">
      <label for="fTeam">Team</label>
      <select id="fTeam"><option value="">All Teams</option></select>
    </div>
    <div class="group">
      <label for="fPlayer">Player</label>
      <select id="fPlayer"><option value="">All Players</option></select>
    </div>
    <div class="group">
      <label>&nbsp;</label>
      <button id="btnReset">Reset Filters</button>
    </div>
  </div>

  <!-- Table -->
  <div class="card">
    <table id="stats">
      <thead>
        <tr>
          <th class="c-left">Player</th>
          <th>Year</th>
          <th>Season</th>
          <th>Program</th>
          <th class="c-left">Team</th>

          <th>GP</th>
          <th>PA</th>
          <th>AB</th>
          <th>R</th>
          <th>H</th>
          <th>1B</th>
          <th>2B</th>
          <th>3B</th>

          <th>HR</th>
          <th>RBI</th>
          <th>BB</th>
          <th>HBP</th>
          <th>SO</th>
          <th>SB</th>
          <th>K-L</th>

          <th>AVG</th>
          <th>OBP</th>
          <th>SLG</th>
          <th>OPS</th>
        </tr>
      </thead>
      <tbody></tbody>
      <tfoot>
        <tr id="totalsRow">
          <td class="c-left">Totals</td>
          <td colspan="4"></td>
          <!-- numeric cells get filled by JS -->
          <td>0</td><td>0</td><td>0</td><td>0</td><td>0</td>
          <td>0</td><td>0</td><td>0</td>
          <td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td>
          <td>0</td><td>0</td><td>0</td><td>0</td>
        </tr>
      </tfoot>
    </table>
  </div>
</div>

<script>
/* ========= Utilities ========= */
const csvPath = 'ntabl-hitting-stats.csv';   // your unified CSV
const $ = sel => document.querySelector(sel);
const $$ = sel => [...document.querySelectorAll(sel)];

/* Parse CSV (simple) */
function parseCSV(text){
  const lines = text.split(/\r?\n/).filter(Boolean);
  const headers = lines[0].split(',').map(h => h.trim());
  const rows = lines.slice(1).map(line=>{
    // naive split that also trims; assumes commas not inside quotes
    return line.split(',').map(x=>x.trim());
  });
  return { headers, rows };
}

/* Unique values for select options */
function unique(arr){ return [...new Set(arr.filter(Boolean))].sort((a,b)=> (a>b?1:-1)); }

/* Build option list */
function fillOptions(select, values){
  const cur = select.value;
  select.innerHTML = '';
  const all = document.createElement('option');
  all.value = '';
  all.textContent = select.id==='fYear' ? 'All Years' :
                    select.id==='fSeason' ? 'All Seasons' :
                    select.id==='fProgram' ? 'All Programs' :
                    select.id==='fTeam' ? 'All Teams' : 'All Players';
  select.appendChild(all);
  unique(values).forEach(v=>{
    const opt = document.createElement('option');
    opt.value = v; opt.textContent = v;
    select.appendChild(opt);
  });
  // restore if exists
  if ([...select.options].some(o=>o.value===cur)) select.value = cur;
}

/* Column map (match table order) */
const COLS = [
  'PLAYER','YEAR','SEASON','PROGRAM','TEAM',
  'GP','PA','AB','R','H','1B','2B','3B',
  'HR','RBI','BB','HBP','SO','SB','K-L',
  'AVG','OBP','SLG','OPS'
];

/* ========= State ========= */
let RAW = [];    // array of objects keyed by header
let FILTERS = { year:'', season:'', program:'', team:'', player:'' };

function applyFilters(){
  return RAW.filter(r =>
    ( !FILTERS.year    || r.YEAR    == FILTERS.year ) &&
    ( !FILTERS.season  || r.SEASON  == FILTERS.season ) &&
    ( !FILTERS.program || r.PROGRAM == FILTERS.program ) &&
    ( !FILTERS.team    || r.TEAM    == FILTERS.team ) &&
    ( !FILTERS.player  || r.PLAYER  == FILTERS.player )
  );
}

/* Totals calculator for numeric columns */
const NUM_KEYS = ['GP','PA','AB','R','H','1B','2B','3B','HR','RBI','BB','HBP','SO','SB'];
function calcTotals(rows){
  const sums = Object.fromEntries(NUM_KEYS.map(k=>[k,0]));
  rows.forEach(r=>{
    NUM_KEYS.forEach(k=>{
      const n = Number(r[k] ?? 0);
      if (!Number.isNaN(n)) sums[k]+=n;
    });
  });
  // derived rate stats if present, otherwise leave 0
  const AB = sums['AB']||0, H = sums['H']||0;
  const OBP = 0; const SLG = 0; // keep zero if not present in CSV
  const AVG = AB ? (H/AB).toFixed(3).slice(1) : '0';
  return { ...sums, AVG, OBP, SLG, OPS:0 };
}

/* Render table */
function render(rows){
  const tbody = $('#stats tbody');
  tbody.innerHTML = '';

  rows.forEach(r=>{
    const tr = document.createElement('tr');

    COLS.forEach((k, idx)=>{
      const td = document.createElement('td');
      let val = r[k] ?? '';
      if (['PLAYER','TEAM'].includes(k)) td.classList.add('c-left');

      // clickable player
      if (k==='PLAYER'){
        const a = document.createElement('a');
        a.href = '#';
        a.className = 'pname';
        a.textContent = val;
        a.addEventListener('click', (e)=>{
          e.preventDefault();
          $('#fPlayer').value = val;
          FILTERS.player = val;
          syncUI();
        });
        td.appendChild(a);
      } else {
        td.textContent = val;
      }

      tr.appendChild(td);
    });

    tbody.appendChild(tr);
  });

  // Totals
  const t = calcTotals(rows);
  const tds = $('#totalsRow').children;
  // cells: [Totals, colspan 4], then follow numeric
  let i = 5; // start where GP begins
  ['GP','PA','AB','R','H','1B','2B','3B','HR','RBI','BB','HBP','SO','SB','K-L','AVG','OBP','SLG','OPS'].forEach(key=>{
    if (!tds[i]) return;
    let v = t[key] ?? 0;
    if (['AVG','OBP','SLG','OPS'].includes(key)){
      // if CSV provides these per row, totals are usually blank/0 (keep 0)
      // display as .000 format when numeric
      v = typeof v==='number' ? v.toFixed(3).slice(1) : v;
    }
    tds[i].textContent = v;
    i++;
  });

  attachColumnHover();
}

/* Column hover logic (non-destructive, works with sticky header) */
function attachColumnHover(){
  const table = $('#stats');
  const rows = $$('#stats tr');

  rows.forEach(row=>{
    [...row.children].forEach((cell, colIdx)=>{
      cell.addEventListener('mouseenter', ()=>{
        // add highlight to this column on all rows
        rows.forEach(r=>{
          const c = r.children[colIdx];
          if (c) c.classList.add('col-hover');
        });
      });
      cell.addEventListener('mouseleave', ()=>{
        rows.forEach(r=>{
          const c = r.children[colIdx];
          if (c) c.classList.remove('col-hover');
        });
      });
    });
  });
}

/* Sync filters + table */
function syncUI(){
  const yr = $('#fYear').value;
  const ss = $('#fSeason').value;
  const pg = $('#fProgram').value;
  const tm = $('#fTeam').value;
  const pl = $('#fPlayer').value;

  FILTERS = { year:yr, season:ss, program:pg, team:tm, player:pl };

  const rows = applyFilters();
  render(rows);
}

/* ========= Init ========= */
fetch(csvPath)
  .then(r=>r.text())
  .then(text=>{
    const {headers, rows} = parseCSV(text);

    // build RAW as objects keyed to expected COLS
    RAW = rows.map(arr=>{
      const obj = {};
      headers.forEach((h, i)=>{
        obj[h.trim().toUpperCase()] = (arr[i] ?? '').trim();
      });
      return obj;
    });

    // Fill select options from RAW
    fillOptions($('#fYear'), RAW.map(r=>r.YEAR));
    fillOptions($('#fSeason'), RAW.map(r=>r.SEASON));
    fillOptions($('#fProgram'), RAW.map(r=>r.PROGRAM));
    fillOptions($('#fTeam'), RAW.map(r=>r.TEAM));
    fillOptions($('#fPlayer'), RAW.map(r=>r.PLAYER));

    // hook events
    ['fYear','fSeason','fProgram','fTeam','fPlayer'].forEach(id=>{
      $('#'+id).addEventListener('change', syncUI);
    });
    $('#btnReset').addEventListener('click', ()=>{
      ['fYear','fSeason','fProgram','fTeam','fPlayer'].forEach(id=>$('#'+id).value='');
      syncUI();
    });

    // initial render
    syncUI();
  })
  .catch(err=>{
    console.error('CSV load error', err);
    $('#stats tbody').innerHTML =
      `<tr><td class="c-left" colspan="${COLS.length}">Error: Unable to load stats.</td></tr>`;
  });
</script>